# Migration `20200921112319-migration`

This migration has been generated by A. David Thyresson at 9/21/2020, 7:23:19 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."ArticleTag" DROP CONSTRAINT "ArticleTag_articleId_fkey"

CREATE TABLE "public"."Tag" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"documentType" "DocumentType"  NOT NULL DEFAULT E'TWEET',
"articleId" text   ,
"tweetId" text   ,
"label" text   NOT NULL ,
"uri" text   NOT NULL ,
"diffbotUris" text []  ,
"dbpediaUris" text []  ,
"allTypes" text []  ,
"rdfTypes" text []  ,
"entityTypes" text []  ,
"mentions" integer   NOT NULL DEFAULT 0,
"confidence" Decimal(65,30)   NOT NULL DEFAULT 0,
"salience" Decimal(65,30)   NOT NULL DEFAULT 0,
"sentiment" Decimal(65,30)   NOT NULL DEFAULT 0,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("articleId")REFERENCES "public"."Article"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("tweetId")REFERENCES "public"."Tweet"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."ArticleTag"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200921011508-migration..20200921112319-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,9 +1,9 @@
 datasource DS {
   // optionally set multiple providers
   // example: provider = ["sqlite", "postgresql"]
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider        = "prisma-client-js"
@@ -45,9 +45,9 @@
   sentiment      Float           @default(0)
   tagLabels      String[]
   url            String          @unique
   articleContext ArticleContext?
-  articleTags    ArticleTag[]
+  tags           Tag[]
 }
 model ArticleContext {
   id        String   @id @default(cuid())
@@ -57,22 +57,8 @@
   articleId String
   content   Json
 }
-model ArticleTag {
-  id        String   @id @default(cuid())
-  createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
-  article   Article? @relation(fields: [articleId], references: [id])
-  articleId String?
-  label     String
-  uri       String
-  count     Int      @default(0)
-  score     Float    @default(0)
-  rdfTypes  String[]
-  sentiment Float    @default(0)
-}
-
 enum StreamSource {
   FEEDLY
 }
@@ -95,8 +81,30 @@
   continuation     String?
   entries          Entry[]
 }
+model Tag {
+  id           String       @id @default(cuid())
+  createdAt    DateTime     @default(now())
+  updatedAt    DateTime     @default(now())
+  documentType DocumentType @default(TWEET)
+  article      Article?     @relation(fields: [articleId], references: [id])
+  articleId    String?
+  tweet        Tweet?       @relation(fields: [tweetId], references: [id])
+  tweetId      String?
+  label        String
+  uri          String
+  diffbotUris  String[]
+  dbpediaUris  String[]
+  allTypes     String[]
+  rdfTypes     String[]
+  entityTypes  String[]
+  mentions     Int          @default(0)
+  confidence   Float        @default(0)
+  salience     Float        @default(0)
+  sentiment    Float        @default(0)
+}
+
 model Tweet {
   id              String          @id @default(cuid())
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @default(now())
@@ -110,8 +118,10 @@
   sentiment       Float           @default(0)
   tweetContext    TweetContext?
   tweetCategories TweetCategory[]
   tweetPriorities TweetPriority[]
+  tags            Tag[]
+
 }
 model TweetCategory {
   id        String   @id @default(cuid())
```


