# Migration `20201022155509-added-notification`

This migration has been generated by A. David Thyresson at 10/22/2020, 11:55:09 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."NotificationAction" AS ENUM ('CREATE', 'UPDATE', 'VIEW')

DROP INDEX "public"."idx_article_category_on_label"

DROP INDEX "public"."idx_article_category_on_uid"

DROP INDEX "public"."idx_article_summary_on_article_id"

DROP INDEX "public"."idx_tag_on_articleId"

DROP INDEX "public"."idx_tag_on_label"

DROP INDEX "public"."idx_tag_on_tweetId"

DROP INDEX "public"."idx_tweet_category_on_label"

DROP INDEX "public"."idx_tweet_category_on_uid"

CREATE TABLE "public"."Notification" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"documentType" "DocumentType"  NOT NULL DEFAULT E'TWEET',
"action" "NotificationAction"  NOT NULL DEFAULT E'CREATE',
"message" text   NOT NULL ,
"tweetId" text   ,
"articleId" text   ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."Notification" ADD FOREIGN KEY ("tweetId")REFERENCES "public"."Tweet"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Notification" ADD FOREIGN KEY ("articleId")REFERENCES "public"."Article"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201015223659-migration..20201022155509-added-notification
--- datamodel.dml
+++ datamodel.dml
@@ -1,22 +1,32 @@
 datasource DS {
   // optionally set multiple providers
   // example: provider = ["sqlite", "postgresql"]
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider        = "prisma-client-js"
   binaryTargets   = ["native", "rhel-openssl-1.0.x"]
   previewFeatures = ["connectOrCreate"]
 }
+generator dbml {
+  provider = "prisma-dbml-generator"
+}
+
 enum DocumentType {
   ARTICLE
   TWEET
 }
+enum NotificationAction {
+  CREATE
+  UPDATE
+  VIEW
+}
+
 model Entry {
   id           String       @id @default(cuid())
   createdAt    DateTime     @default(now())
   updatedAt    DateTime     @default(now())
@@ -47,9 +57,10 @@
   tags              Tag[]
   tweets            Tweet[]
   articleCategories ArticleCategory[]
   summaries         ArticleSummary[]
-  ArticlePriority   ArticlePriority[]
+  articlePriorities ArticlePriority[]
+  notifications     Notification[]
 }
 model ArticleCategory {
   id        String   @id @default(cuid())
@@ -124,8 +135,21 @@
   streamIdentifier String       @unique
   continuation     String?
 }
+model Notification {
+  id           String             @id @default(cuid())
+  createdAt    DateTime           @default(now())
+  updatedAt    DateTime           @default(now())
+  documentType DocumentType       @default(TWEET)
+  action       NotificationAction @default(CREATE)
+  message      String
+  tweet        Tweet?             @relation(fields: [tweetId], references: [id])
+  article      Article?           @relation(fields: [articleId], references: [id])
+  tweetId      String?
+  articleId    String?
+}
+
 model Tag {
   id           String       @id @default(cuid())
   createdAt    DateTime     @default(now())
   updatedAt    DateTime     @default(now())
@@ -166,8 +190,9 @@
   tweetCategories TweetCategory[]
   tweetPriorities TweetPriority[]
   tags            Tag[]
   articles        Article[]
+  notifications   Notification[]
 }
 model TweetCategory {
   id        String   @id @default(cuid())
```


